<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Unit 2, Lesson 5: A Friend of the Earth - Interactive Quiz</title>
  <link rel="stylesheet" href="../assets/css/styles.css">
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Unit 2, Lesson 5: A Friend of the Earth</h1>
        <div class="subtitle">By Sharif Uddin</div>
      </div>
      <div class="row">
        <button id="btn-home-header" class="ghost" style="margin-right: auto;">‚Üê Home</button>
        <span class="pill" id="mode-pill">Mode: Mixed</span>
        <span class="pill" id="score-pill">Score: 0</span>
        <span class="pill" id="q-pill">Q 0 / 0</span>
      </div>
    </header>

    <div class="card" id="quiz-card">
      <div class="progress"><div class="bar" id="bar"></div></div>
      <div class="meta">
        <span class="badge" id="type-badge">MCQ</span>
        <span class="badge">Auto-advance: <span id="auto-state">On</span></span>
        <span class="badge" id="timer">Time: 0s</span>
      </div>
      <div id="q-container">
        <!-- question will render here -->
      </div>
      <div class="feedback" id="feedback"></div>
      <div class="footer">
        <div class="controls">
          <button class="ghost" id="btn-prev">‚üµ Prev</button>
          <button id="btn-submit" class="primary">Submit</button>
          <button id="btn-next">Next ‚ü∂</button>
          <button class="ghost" id="btn-skip">Skip</button>
        </div>
        <label class="toggle"><input type="checkbox" id="autoToggle" checked /> Auto next</label>
      </div>
    </div>

    <div class="card review" id="result-card" style="display:none">
      <h2>Result</h2>
      <p class="muted" id="summary"></p>
      <div id="breakdown" class="row"></div>
      <h3>Review Answers</h3>
      <table id="review-table">
        <thead>
          <tr><th>#</th><th>Type</th><th>Question</th><th>Your Answer</th><th>Correct</th><th>Status</th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="row" style="margin-top:12px">
        <button id="btn-restart">Restart Quiz</button>
        <button id="btn-print">Print / Save PDF</button>
        <button id="btn-home" class="ghost">‚Üê Back to Home</button>
      </div>
    </div>

    <details class="card" style="margin-top:16px">
      <summary>üß∞ Teacher Panel (edit questions live)</summary>
      <p class="muted">You can copy/download this file and edit the <code>QUESTIONS</code> array below to customize. Changes here only apply while the page is open.</p>
      <textarea id="editor" style="width:100%;height:220px;background:#0b1220;color:#e5e7eb;border:1px solid #263246;border-radius:12px;padding:10px"></textarea>
      <div class="row" style="margin-top:8px">
        <button id="btn-apply">Apply JSON</button>
        <span class="muted">Tip: Press <span class="kbd">Ctrl/‚åò + S</span> to download this page.</span>
      </div>
    </details>

  </div>

  <script src="../assets/js/quiz-engine.js"></script>
  <script>
    // Load questions from JSON file
    let QUESTIONS = [];
    
    // Load questions from JSON file
    fetch('../data/unit2-lesson5-questions.json')
      .then(response => response.json())
      .then(data => {
        QUESTIONS = data;
        initQuiz();
      })
      .catch(error => {
        console.error('Error loading questions:', error);
        // Fallback to embedded questions if JSON fails
        QUESTIONS = [
          {
            "id": 1,
            "type": "mcq",
            "points": 1,
            "q": "What is the main purpose of reading the passage? (‡¶≤‡ßá‡¶ñ‡¶æ‡¶ü‡¶ø ‡¶™‡¶°‡¶º‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶® ‡¶â‡¶¶‡ßç‡¶¶‡ßá‡¶∂‡ßç‡¶Ø ‡¶ï‡ßÄ?)",
            "opts": [
              "To learn how to save money (‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶¨‡¶æ‡¶Å‡¶ö‡¶æ‡¶¨‡ßã ‡¶∂‡ßá‡¶ñ‡¶æ)",
              "To know how to save our environment (‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡ßá‡¶∂ ‡¶∞‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶â‡¶™‡¶æ‡¶Ø‡¶º ‡¶ú‡¶æ‡¶®‡¶æ)",
              "To find new places to visit (‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ)",
              "To learn about animals (‡¶™‡ßç‡¶∞‡¶æ‡¶£‡ßÄ ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡ßá ‡¶ú‡¶æ‡¶®‡¶æ)"
            ],
            "ans": 1,
            "exp": "The main purpose of the passage is to know how to save our environment."
          }
        ];
        initQuiz();
      });

    let quiz;

    function initQuiz() {
      quiz = new QuizEngine(QUESTIONS);
      setupEventListeners();
      $('#editor').value = JSON.stringify(QUESTIONS, null, 2);
    }

    function setupEventListeners() {
      // Quiz controls
      $('#btn-submit').addEventListener('click', () => quiz.checkAnswer());
      $('#btn-next').addEventListener('click', () => quiz.goNext());
      $('#btn-prev').addEventListener('click', () => quiz.goPrev());
      $('#btn-skip').addEventListener('click', () => quiz.skip());
      $('#btn-restart').addEventListener('click', () => quiz.restart());
      $('#btn-print').addEventListener('click', () => window.print());
      $('#btn-home').addEventListener('click', () => window.location.href = '../index.html');
      $('#btn-home-header').addEventListener('click', () => window.location.href = '../index.html');
      
      // Auto-advance toggle
      $('#autoToggle').addEventListener('change', (e) => {
        quiz.setAutoAdvance(e.target.checked);
      });

      // Teacher panel
      $('#btn-apply').addEventListener('click', () => {
        try {
          const arr = JSON.parse($('#editor').value);
          if (!Array.isArray(arr)) throw new Error('JSON must be an array');
          QUESTIONS.length = 0;
          arr.forEach(o => QUESTIONS.push(o));
          initQuiz();
          alert('Applied! Questions reloaded.');
        } catch (e) {
          alert('Invalid JSON: ' + e.message);
        }
      });

      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowRight') quiz.goNext();
        if (e.key === 'ArrowLeft') quiz.goPrev();
        if (e.key.toLowerCase() === 's' && (e.ctrlKey || e.metaKey)) {
          e.preventDefault();
          const blob = new Blob([document.documentElement.outerHTML], { type: 'text/html' });
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = 'unit2-lesson5-quiz.html';
          a.click();
        }
      });
    }
  </script>
</body>
</html>
